# http 缓存

## 强缓存

- Pragma（http1.0）

  - 这是一种比较古老的请求头，只建议在向下兼容 http1.0 的时候使用，当值为 Pragma:no-cache，效果和 Cache-Control:no-cache 一样

- Expires（http1.0）

  - 通过服务端设置，给 Response Headers 添加一个 GMT（格林尼治时间）作为 Express 的响应头，客户端在发请求前，判断 Express 的时间是否已经过期来决定是否向服务端发送请求
  - 由于客户端在做判断的时候取的是自己电脑的时间，所以当用户的电脑时间出现问题时，会影响到缓存的正常使用

- cacha-control（http1.1）
  | 名称 | 描述 |
  | -------- | ------------------------ |
  | max-age=time | 缓存内容将在 time 秒后失效 |
  | public | 客户端和代理服务器都可以缓存 |
  | private | 客户端可以缓存 |
  | no-cache | 需要使用协商缓存来验证缓存数据 |
  | no-store | 所有内容都不会缓存 |

## 协商缓存

- 协商缓存需要进行对比判断是否可以使用缓存。浏览器第一次请求数据时，服务器会将缓存标识与数据一起响应给客户端，客户端将它们备份至缓存中。再次请求时，客户端会将缓存中的标识发送给服务器，服务器根据此标识判断。若未失效，返回 304 状态码，浏览器拿到此状态码就可以直接使用缓存数据了。
- Etag
  - 服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）
  - If-None-Match
    - 再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现 If-None-Match 则与被请求资源的唯一标识进行对比
- Last-Modifind
  - 服务端响应请求时会在响应头里面包含最后一次修改时间
  - if-Modified-Since
    - 浏览器再次请求带着上次响应返回的 Last-Modifind 的值
  - if-Unmodified-Since
    - 从某个时间点算起, 是否文件没有被修改

## 参考

- [HTTP 缓存](https://juejin.im/post/6844904047523135496)
